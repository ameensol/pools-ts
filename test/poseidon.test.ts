// see: https://github.com/iden3/circomlib/blob/v0.5.5/test/poseidonjs.js
import { expect } from 'chai'
import { BigNumber } from '@ethersproject/bignumber'
import { poseidon } from '../src/poseidon'

/*
  We want to test that the poseidon hash function is deterministic. These are the test vectors from the EIP-5988.

  source: https://eips.ethereum.org/assets/eip-5988/test/poseidon/test_vectors.txt

# poseidonperm_x5_254_3
Input:
[
  '0x0000000000000000000000000000000000000000000000000000000000000000',
  '0x0000000000000000000000000000000000000000000000000000000000000001',
  '0x0000000000000000000000000000000000000000000000000000000000000002'
]
Output:
[
  '0x115cc0f5e7d690413df64c6b9662e9cf2a3617f2743245519e19607a4417189a',
  '0x0fca49b798923ab0239de1c9e7a4a9a2210312b6a2f616d18b5a87f9b628ae29',
  '0x0e7ae82e40091e63cbd4f16a6d16310b3729d4b6e138fcf54110e2867045a30c'
]

# poseidonperm_x5_254_5
Input:
[
  '0x0000000000000000000000000000000000000000000000000000000000000000',
  '0x0000000000000000000000000000000000000000000000000000000000000001',
  '0x0000000000000000000000000000000000000000000000000000000000000002',
  '0x0000000000000000000000000000000000000000000000000000000000000003',
  '0x0000000000000000000000000000000000000000000000000000000000000004'
]
Output:
[
  '0x299c867db6c1fdd79dcefa40e4510b9837e60ebb1ce0663dbaa525df65250465',
  '0x1148aaef609aa338b27dafd89bb98862d8bb2b429aceac47d86206154ffe053d',
  '0x24febb87fed7462e23f6665ff9a0111f4044c38ee1672c1ac6b0637d34f24907',
  '0x0eb08f6d809668a981c186beaf6110060707059576406b248e5d9cf6e78b3d3e',
  '0x07748bc6877c9b82c8b98666ee9d0626ec7f5be4205f79ee8528ef1c4a376fc7'
]
*/

describe('poseidon.ts', function() {

  it('Should match reference test vectors for poseidonperm_x5_254_3', () => {
    expect(poseidon([1, 2], 3)).to.be.deep.equal([
      BigNumber.from('0x115cc0f5e7d690413df64c6b9662e9cf2a3617f2743245519e19607a4417189a'),
      BigNumber.from('0x0fca49b798923ab0239de1c9e7a4a9a2210312b6a2f616d18b5a87f9b628ae29'),
      BigNumber.from('0x0e7ae82e40091e63cbd4f16a6d16310b3729d4b6e138fcf54110e2867045a30c')
    ])
  })

  it('Should match reference test vectors for poseidonperm_x5_254_5', () => {
    expect(poseidon([1, 2, 3, 4], 5)).to.be.deep.equal([
      BigNumber.from('0x299c867db6c1fdd79dcefa40e4510b9837e60ebb1ce0663dbaa525df65250465'),
      BigNumber.from('0x1148aaef609aa338b27dafd89bb98862d8bb2b429aceac47d86206154ffe053d'),
      BigNumber.from('0x24febb87fed7462e23f6665ff9a0111f4044c38ee1672c1ac6b0637d34f24907'),
      BigNumber.from('0x0eb08f6d809668a981c186beaf6110060707059576406b248e5d9cf6e78b3d3e'),
      BigNumber.from('0x07748bc6877c9b82c8b98666ee9d0626ec7f5be4205f79ee8528ef1c4a376fc7')
    ])
  })

})